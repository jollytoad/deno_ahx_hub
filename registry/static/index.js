(()=>{var lt=Object.defineProperty;var at=(e,t)=>{for(var o in t)lt(e,o,{get:t[o],enumerable:!0})};var ye=!1;document.addEventListener("DOMContentLoaded",function(){ye=!0},{once:!0,passive:!0});function ge(e){ye?e(document):document.addEventListener("DOMContentLoaded",()=>e(document),{once:!0,passive:!0})}var fe={};at(fe,{controls:()=>Nt,elements:()=>mt,eventsAll:()=>re,eventsNone:()=>pt,forms:()=>Ot,internals:()=>ct,logger:()=>ne,loggerConfig:()=>P,owners:()=>Pt,slots:()=>Lt});var C=new Map,B=new Set,_=new WeakMap;function A(e,t,o){if(C.has(t)||C.set(t,new WeakMap),C.get(t).set(e,o),!_.has(e)){let r=new WeakRef(e);B.add(r),_.set(e,r)}}function d(e,t,o){return o&&!D(e,t)&&A(e,t,o()),C.get(t)?.get(e)}function D(e,t){return!!C.get(t)?.has(e)}function xe(e,t){if(t)C.get(t)?.delete(e);else{for(let r of C.values())r.delete(e);let o=_.get(e);o&&(B.delete(o),_.delete(e))}}function Ee(e,t){for(let[o,r]of C.entries())if(o.startsWith("triggered:")){let n=r.get(e);n!==void 0&&A(t,o,n)}}function*b(e){let t=C.get(e);if(t)for(let o of B){let r=o.deref();r&&t.has(r)&&(yield[r,t.get(r)])}}function*T(){for(let e of B){let t=e.deref();if(t)for(let[o,r]of C.entries())r.has(t)&&(yield[t,o,r.get(t)])}}function ct(){console.group("ahx internal properties...");let e;for(let[t,o,r]of T()){if(t!==e){e&&console.groupEnd();let n=t instanceof CSSRule?t.cssText:t;if(console.groupCollapsed(n),console.dir(t),t instanceof CSSStyleRule)for(let s of document.querySelectorAll(t.selectorText))console.log(s);e=t}if(r instanceof Map){console.group("%s:",o);for(let n of r)console.log("%c%s:","font-weight: bold",...n);console.groupEnd()}else console.log("%c%s:","font-weight: bold",o,r)}console.groupEnd()}var p={prefix:"ahx",httpMethods:["get","post","put","patch","delete"],ahxAttrs:["trigger","target","slot-name"],maxLoopCount:10,defaultDelay:20,defaultSettleDelay:20,defaultSwapDelay:0,enableDebugEvent:!1,pseudoChildTags:{article:"div",aside:"div",audio:"track",body:"div",canvas:null,colgroup:"col",datalist:"option",div:"div",dl:"dt",footer:"div",form:"fieldset",head:null,header:"div",hgroup:"div",html:null,iframe:null,main:"div",map:"area",menu:"li",noscript:null,object:null,ol:"li",optgroup:"option",p:"span",picture:"source",portal:null,pre:null,script:null,section:"div",select:"option",span:"span",style:null,table:"tbody",tbody:"tr",template:null,textarea:null,tfoot:"tr",thead:"tr",tr:"td",ul:"li",video:"track",area:null,base:null,br:null,col:null,embed:null,hr:null,img:null,input:null,link:null,meta:null,param:null,source:null,track:null,wbr:null,"*":"slot"}};var P={group:!1,include:[]};function re(){p.enableDebugEvent=!0,addEventListener(p.prefix,ne)}function pt(){p.enableDebugEvent=!1,removeEventListener(p.prefix,ne)}function ne({detail:e}){let{type:t,target:o,detail:r}=e;if(ft(t))if(r?._after&&P.group&&console.groupEnd(),r?._before){let n=P.group?P.group===!0?"group":"groupCollapsed":"debug";console[n]("%s -> %o %o",t,o,r)}else console.debug("%s -> %o %o",t,o,r)}function ft(e){return P.include?.length?!!P.include.some(t=>e.includes(`:${t}`)):!0}function k(e){let t=new Set;for(let o of e.style)se(o)&&t.add(o);return t}function we(e){for(let t of e.attributes)if(ie(t.name))return!0;return!1}function se(e){return e.startsWith(`--${p.prefix}-`)}function ie(e){return e.startsWith(`${p.prefix}-`)}function ut(e){return e.startsWith(`${p.prefix}-`)}function E(e){return se(e)?e:ie(e)?`--${e}`:`--${p.prefix}-${e}`}function L(e){return ie(e)?e:se(e)?e.substring(2):`${p.prefix}-${e}`}function F(e){return ut(e)?e:`${p.prefix}-${e}`}function w(e){if(e instanceof Element)return e;if(e&&"ownerNode"in e&&e.ownerNode&&e.ownerNode instanceof Element)return e.ownerNode;if(e?.parentStyleSheet)return w(e.parentStyleSheet);if(e&&"ownerRule"in e)return w(e.ownerRule)}function g(e,t,o,r="tokens"){e=E(e);let n=t.style.getPropertyValue(e)?.trim();if(n){let i=/^attr\(([^\)\s,]+)(?:\s+([^\)\s,]+))?\)$/.exec(n);if(i)return o?(n=o.getAttribute(i[1])??void 0,n&&i[2]==="url"&&(n=s(n,o.baseURI)),n?[n]:[]):[n];{let c=/^--prop\(([^\)\s,]+)(?:\s+([^\)\s,]+))?\)$/.exec(n);if(c){if(!o)return[n];n=void 0;let a=o[c[1]];return c[2]==="url"&&typeof a=="string"?n=s(a,o.baseURI):(typeof a=="string"||typeof a=="number"||typeof a=="boolean")&&(n=String(a)),n?[n]:[]}}let l=/^url\(([^\)]*)\)(?:\s+url\(([^\)]*)\))*$/.exec(n);if(l){let[,...c]=l,a=t.parentStyleSheet?.href??t.style.parentRule?.parentStyleSheet?.href??o?.baseURI??w(t)?.baseURI;return c.flatMap(f=>{let S=f?s(le(f),a):void 0;return S?[S]:[]})}n=le(n)}return n?r==="tokens"?n.split(/\s+/).map(le):[n]:[];function s(i,l){try{return new URL(i,l).href}catch(c){console.error(c,i,l)}}}function le(e){let t=/^\"([^\"]*)\"$/.exec(e)??/^\'([^\']*)\'$/.exec(e);return t?t[1]:e}function I(e,t,o="tokens"){e=L(e);let r=t.getAttribute(e)??void 0;return r?o==="tokens"?r.split(/\s+/):[r]:[]}function x(e,t,o="tokens"){return t instanceof Element?I(e,t,o):g(e,t,void 0,o)}function v(e,t){if(e===t)return 0;let o=e.compareDocumentPosition(t);return o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS?1:0}function mt(e){console.group("ahx elements...");let t=new Set,o=new Set;for(let[r]of T())r instanceof Element?t.add(r):r instanceof CSSStyleRule&&o.add(r);for(let r of o)for(let n of document.querySelectorAll(r.selectorText))n instanceof Element&&t.add(n);for(let r of[...t].sort(v))if(e){let n=I(e,r);n.length&&console.log(r,...n)}else console.log(r);console.groupEnd()}function W(e,t,o,r=!0){if(e!==null){let n=new CustomEvent(t,{bubbles:!!e,cancelable:r,detail:o});return p.enableDebugEvent&&dispatchEvent(new CustomEvent(p.prefix,{bubbles:!1,cancelable:!1,detail:{type:n.type,target:e,bubbles:n.bubbles,cancelable:n.cancelable,detail:n.detail}})),e&&"dispatchEvent"in e?e.dispatchEvent(n):dispatchEvent(n)}return!1}function j(e,t,o){W(e,`${p.prefix}:${t}`,o,!1)}function u(e,t,o){o._before=!0;let r=W(e,`${p.prefix}:${t}`,o);return delete o._before,r||W(e,`${p.prefix}:${t}:veto`,o,!1),r}function m(e,t,o){o._after=!0,W(e,`${p.prefix}:${t}:done`,o,!1),delete o._after}function R(e,t,o){W(e,`${p.prefix}:${t}:error`,{error:t,...o},!1)}function G(e,t){return dt(e,t,!1)}function dt(e,t,o){if(!t)return s();let[r,n]=St(t);switch(r){case"this":return s(e);case"closest":return s(e.closest(n));case"find":return o?e.querySelectorAll(n):e.querySelector(n)??void 0;case"next":return s(ht(e,n));case"previous":return s(yt(e,n));case"body":return s(e.ownerDocument.body);case"document":case"window":return s();default:return o?e.ownerDocument.querySelectorAll(t):e.ownerDocument.querySelector(t)??void 0}function s(i){return o?i?[i]:[]:i??void 0}}function St(e){let t=e.indexOf(" ");return t===-1?[e,""]:[e.substring(0,t),e.substring(t+1)]}function ht(e,t){for(let o of e.ownerDocument.querySelectorAll(t))if(o.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_PRECEDING)return o}function yt(e,t){let o=e.ownerDocument.querySelectorAll(t);for(let r=o.length-1;r>=0;r--){let n=o[r];if(n?.compareDocumentPosition(e)===Node.DOCUMENT_POSITION_FOLLOWING)return n}}async function*gt(){let e=this.getReader();try{let t,o;do({done:t,value:o}=await e.read()),o!==void 0&&(yield o);while(!t)}finally{e.releaseLock()}}ReadableStream.prototype[Symbol.asyncIterator]??=gt;var Q=class extends TransformStream{constructor(t,o){let r,n;super({start(){r=t.implementation.createHTMLDocument()},transform(s,i){if(r.write(s),!n&&r.body?.childElementCount>0){let l=r.body.children[0];o&&l instanceof HTMLTemplateElement?n=l.content:n=r.body}for(;n?.childElementCount>1;){let l=n.children[0];t.adoptNode(l),i.enqueue(l)}},flush(s){for(let i of[...n?.children??[]])t.adoptNode(i),s.enqueue(i);r.close(),r=void 0,n=void 0}})}};function h(e){if(D(e,"owner"))return d(e,"owner");if(e instanceof StyleSheet)return d(e,"owner")??e.href??void 0;if(e instanceof CSSRule&&e.parentStyleSheet)return h(e.parentStyleSheet);if(e instanceof Element&&e.parentElement)return h(e.parentElement)}function N(e,t){t!==h(e)&&A(e,"owner",t)}function Ce(e,t,o){let r=[];for(let[n,s]of b("slotName"))s.has(e)&&(n instanceof Element?r.push(n):n instanceof CSSStyleRule&&r.push(...o.querySelectorAll(n.selectorText)));return t&&(r=r.filter(n=>n.matches(t))),r}function Ae(e){if(e!=null)return e.slice(-2)=="ms"?parseFloat(e.slice(0,-2))||void 0:e.slice(-1)=="s"?parseFloat(e.slice(0,-1))*1e3||void 0:e.slice(-1)=="m"?parseFloat(e.slice(0,-1))*1e3*60||void 0:parseFloat(e)||void 0}function be(e){return ve(e,"swap")}function Te(e){let{swapStyle:t}=ve(e,"slot-swap");switch(t){case"none":case"inner":case"afterbegin":case"beforeend":return{swapStyle:t};default:return{}}}function ve(e,t){let o=x(t,e,"tokens"),r={};if(o?.length){r.swapStyle=o.shift()?.toLowerCase(),(r.swapStyle==="attr"||r.swapStyle==="input")&&(r.itemName=o.shift());for(let n of o){let[s,i]=n.split(":");switch(s){case"swap":case"delay":r.delay=Ae(i);break;case"join":r.merge="join",r.separator=xt(i);break;case"append":r.merge="append";break}}}return r}function xt(e=" "){switch(e){case"space":return" ";case"comma":return",";default:return e}}function ae(e){let[t,...o]=I("slot",e,"tokens"),r=o.join(" "),n=Te(e);return{slot:t,selector:r,...n}}async function Re(e){let{response:t,target:o}=e,r=o.ownerDocument;if(t?.ok&&t.headers.get("Content-Type")?.startsWith("text/html")&&t.body){let n=0,s,i=!1,l={swapStyle:"inner"},c={},a=t.body.pipeThrough(new TextDecoderStream).pipeThrough(new Q(r,!0));for await(let f of a){switch(f.localName){case`${p.prefix}-target`:{c=ae(f),console.log("ahx-target",c);continue}case`${p.prefix}-replace-previous`:i=!0;continue;case`${p.prefix}-flush`:continue}let S=e.swapStyle??"none",y=[o],V=ae(f),H=V.slot||c.slot||l.slot,st=V.selector||c.selector||l.selector;if(H){let O=Ce(H,st,r);O.length?(y=O,S=V.swapStyle||c.swapStyle||l.swapStyle||"inner"):S="none",console.log("slots",O,S)}let me=y.length?f:void 0;for(let O of y){me&&(f=me.cloneNode(!0));let oe={...e,swapStyle:S,target:O,element:f,previous:s,index:n,slot:H};if(u(O,"swap",oe)){let{target:de,element:K,controlOwner:Se,swapStyle:it,slot:he}=oe;Se&&N(K,Se),he||!s?Et[it]?.(de,K):s&&i?(s.replaceWith(K),i=!1):s.after(K),he||(s=K),m(de,"swap",oe)}}n++}}}var J=e=>(t,o)=>{t.insertAdjacentElement(e,o)},Et={none(){},inner(e,t){typeof Idiomorph<"u"?Idiomorph.morph(e,t,{morphStyle:"innerHTML",ignoreActiveValue:!0}):e.replaceChildren(t)},outer(e,t){let o=`${p.prefix}-pseudo`;for(let r of e.classList)r.startsWith(o)&&t.classList.add(r);Ee(e,t),typeof Idiomorph<"u"?Idiomorph.morph(e,t,{morphStyle:"outerHTML",ignoreActiveValue:!0}):e.replaceWith(t)},beforebegin:J("beforebegin"),afterbegin:J("afterbegin"),beforeend:J("beforeend"),afterend:J("afterend")};function De(e){let{target:t,itemName:o,merge:r,separator:n}=e,s={...e};if(s.oldValue=t.getAttribute(o)??void 0,r==="join"&&s.oldValue&&s.value&&(s.value=wt(s.oldValue,s.value,n)),u(t,"swap",s)){let{target:i,itemName:l,value:c}=s;l&&c!==void 0&&i.setAttribute(l,c),m(i,"swap",s)}}function wt(e,t,o=" "){let r=new Set(`${e}${o}${t}`.split(o));return r.delete(""),[...r].join(o)}function Pe(e){let{target:t,itemName:o,merge:r,separator:n,value:s}=e;if(!o||s===void 0)return;let i={...e};if(t instanceof HTMLFormElement)switch(i.input=t.elements.namedItem(o)??void 0,r){case"append":i.input=Ne(o,t.ownerDocument);break;default:i.input?"value"in i.input&&(i.oldValue=i.input.value):i.input=Ne(o,t.ownerDocument);break}else{i.formData=d(t,"formData",()=>new FormData);let l=i.formData.get(o);typeof l=="string"&&(i.oldValue=l)}if(r==="join"&&(i.value=Ct(i.oldValue,i.value,n)),u(t,"swap",i)){let{target:l,input:c,itemName:a,merge:f,formData:S,value:y}=i;a&&y!==void 0&&(c&&"value"in c?(c.value=y,c instanceof Element&&!c.parentElement&&l.insertAdjacentElement("beforeend",c)):S&&(f==="append"?S.append(a,y):S.set(a,y))),m(l,"swap",i)}}function Ne(e,t){let o=t.createElement("input");return o.type="hidden",o.name=e,o}function Ct(e="",t="",o=" "){let r=new Set(`${e}${o}${t}`.split(o));return r.delete(""),[...r].join(o)}function Ie(e){let{swapStyle:t}=e;switch(t){case"input":return Pe(e);case"attr":return De(e)}}async function z(e){let{swapStyle:t,response:o,itemName:r}=e,{value:n}=e;switch(t){case"input":case"attr":return r?(n===void 0&&o&&(n=await o.text()),Ie({...e,swapStyle:t,itemName:r,value:n})):void 0;default:if(At(o))return Re({...e,swapStyle:t??"none",response:o})}}function At(e){return!!e?.headers.get("Content-Type")?.startsWith("text/html")&&!!e.body}function Oe(e,t){if(e instanceof CSSStyleRule){let[o]=g("headers",e,t,"whole");try{let r=JSON.parse(o);return new Headers(r)}catch{R(t,"invalidCssValue",{prop:E("headers"),value:o,rule:e,reason:"Must be a valid JSON object of request headers"})}}}async function ke(e){let{source:t,action:o,target:r,swap:n,controlOwner:s,targetOwner:i}=e;if(o.type!=="request")return;let l=bt({...e,action:o});if(!l)return;let c={request:l};if(u(t,"request",c)){let{request:a}=c;try{let f=await fetch(a);if(m(t,"request",{request:a,response:f}),f.headers.has(F("refresh"))){let S={...e,request:a,response:f,refresh:!0,url:new URL(location.href)};if(u(t,"navigate",S)){location.reload();return}}await z({...n,target:r,response:f,controlOwner:s,targetOwner:i})}catch(f){m(t,"request",{request:a,error:f})}}}function bt(e){let{action:t,formData:o,source:r,control:n}=e;if(!t.url){R(r,"invalidRequest",{action:t,reason:"Missing URL"});return}let s=new URL(t.url),i=Oe(n,r)??new Headers,l={method:t.method.toUpperCase(),headers:i};if(i.has("Accept")||i.set("Accept","text/html,application/xhtml+xml,text/plain;q=0.9"),i.set(F("request"),"true"),i.set(F("current-url"),r.ownerDocument.location.href),o)switch(l.method){case"GET":case"HEAD":case"DELETE":for(let[c,a]of o)typeof a=="string"&&s.searchParams.append(c,a);break;case"PUT":case"POST":case"PATCH":Tt(o)?(l.body=o,i.set("Content-Type","multipart/form-data")):(l.body=new URLSearchParams(o),i.set("Content-Type","application/x-www-form-urlencoded"))}return new Request(s,l)}function Tt(e){for(let t of e.values())if(t instanceof File)return!0;return!1}async function Le(e){let{event:t,source:o,action:r,target:n,swap:s,control:i,sourceOwner:l,controlOwner:c,targetOwner:a}=e;if(!(i instanceof CSSStyleRule)||r.type!=="harvest")return;let[f]=g("harvest",i,o);if(f===void 0)return;let S=vt(t),y={source:o,oldValue:S,newValue:f,control:i,sourceOwner:l,targetOwner:a,controlOwner:c};u(o,"harvest",y)&&(await z({...s,target:n,value:y.newValue}),m(o,"harvest",y))}function vt(e){if(e instanceof CustomEvent&&"oldValue"in e.detail)return e.detail.oldValue}async function $e(e){let{source:t,action:o,target:r,control:n,sourceOwner:s,controlOwner:i,targetOwner:l}=e;if(!(n instanceof CSSStyleRule)||o.type!=="dispatch")return;let[c]=g("dispatch",n,t);if(!c)return;let a={source:t,target:r,control:n,sourceOwner:s,targetOwner:l,controlOwner:i,event:new CustomEvent(c,{bubbles:!0,cancelable:!0,detail:{}})};if(u(t,"dispatch",a)){let f=!r.dispatchEvent(a.event);m(t,"dispatch",{...a,cancelled:f})}}async function Y(e){let{source:t,control:o,action:r}=e,[n]=x("include",o,"whole"),s=G(t,n);if(e.formData=s?Rt(s):void 0,r.type==="request"&&o instanceof CSSStyleRule&&r.url===void 0){let[i]=g(r.method,o,t);i&&(e.action={...r,url:new URL(i,t.baseURI)})}if(u(t,"action",e)){switch(e.action.type){case"request":await ke(e);break;case"harvest":await Le(e);break;case"dispatch":await $e(e);break}m(t,"action",e)}}function Rt(e){if(D(e,"formData"))return d(e,"formData");if(e instanceof HTMLFormElement)return new FormData(e)}var ce=new Set;function Me(e){u(e.source,"queue",e)&&ce.add(e)}function qe(e){ce.delete(e),m(e.source,"queue",e)}function Ve(){return ce.values()}function He(e){let{control:t,trigger:o,source:r}=e;if(pe(r)){R(r,"triggerDenied",e);return}if(o?.once&&d(r,`triggered:${o.eventType}`)?.has(t))return;o?.changed,u(r,"trigger",e)&&(o?.once&&d(r,`triggered:${o.eventType}`,()=>new WeakSet).add(t),o?.throttle||(o?.delay?setTimeout(n,o.delay):setTimeout(n,0)),m(r,"trigger",e));function n(){Dt(e)?Y(e):Me(e)}}function pe(e){let[t]=x("deny-trigger",e);return t==="true"}function Dt(e){return e.target instanceof Element}function Nt(e=!1){console.group("ahx controls...");let t=new Map;function o(n,s,i){t.has(n)||t.set(n,new Map),t.get(n).set(i,s)}for(let[n,s,i]of T())if(s.startsWith("control:")){if(n instanceof Element)o(n,n,i);else if(n instanceof CSSStyleRule)for(let l of document.querySelectorAll(n.selectorText))l instanceof Element&&o(l,n,i)}let r=[...t.keys()].sort(v);for(let n of r){let s=t.get(n)??[],i=new Set,l=pe(n);for(let[{trigger:c}]of s)i.add(c.eventType);console.groupCollapsed("%o : %c%s",n,l?"text-decoration: line-through; color: grey":"color: red",[...i].join(", "));for(let[{trigger:c,action:a,swap:f},S]of s)if(e)console.log("trigger:",c,"action:",a,"swap:",f,"control:",S);else{let y=S instanceof Element?"element":S.cssText,V="method"in a?`${a.method.toUpperCase()} ${a.url}`:a.type,H=(f?.swapStyle??"default")+(f?.itemName?` ${f.itemName}`:"");console.log("%c%s%c -> %c%s%c -> %c%s%c from: %c%s%c","color: red; font-weight: bold",c.eventType,"color: inherit; font-weight: normal","color: green",V,"color: inherit","color: darkorange",H,"color: inherit","color: hotpink",y,"color: inherit")}console.groupEnd()}console.groupEnd()}function Pt(){console.group("ahx ownership...");let e=new Set;for(let[t,o,r]of T())t instanceof Element?e.add(t):o==="owner"&&(t instanceof CSSRule?console.log("%o -> %s",t.cssText,r):console.log("%o -> %s",t,r));for(let t of[...e].sort(v)){let o=d(t,"owner");console.log("%o -> %s",t,o??"none")}console.groupEnd()}function X(e){return!!e.parentStyleSheet&&!e.parentStyleSheet.disabled}var It=0;function Ke(e){return d(e,"ruleId",()=>`${++It}`)}function $(e,t){let[o=""]=x("target",t,"whole"),r=/^await\s+/.test(o);r&&(o=o.substring(5).trimStart());let n=G(e,o);return r?n??"await":n??e}function Ot(){console.group("ahx form...");let e=new Set;for(let[t]of b("formData"))t instanceof Element&&e.add(t);for(let[t]of kt("harvest"))for(let o of document.querySelectorAll(t.selectorText)){let r=$(o,t);r instanceof Element&&e.add(r)}for(let t of[...e].sort(v)){let o=t instanceof HTMLFormElement?new FormData(t):d(t,"formData");if(o){console.group(t);for(let[r,n]of o??[])console.log("%s: %c%s",r,"font-weight: bold",n);console.groupEnd()}}console.groupEnd()}function*kt(e){for(let[t,o,r]of T())o.startsWith("control:")&&t instanceof CSSStyleRule&&typeof r=="object"&&"action"in r&&r.action.type===e&&X(t)&&(yield[t,r])}function Lt(){console.group("ahx slots...");let e=new Map;function t(o,r){let n=e.get(o)??e.set(o,new Set).get(o);r.forEach(s=>n.add(s))}for(let[o,r]of b("slotName"))if(o instanceof Element)t(o,r);else if(o instanceof CSSStyleRule){let n=document.querySelectorAll(o.selectorText);for(let s of n)t(s,r)}for(let o of[...e.keys()].sort(v))console.log(o,...e.get(o));console.groupEnd()}function We(e){let[t]=x("trigger",e,"whole"),o=[];if(t){let r=t.split(/\s*,\s*/);for(let n of r){let[s,...i]=n.split(/\s+/);if(s){let l={eventType:s};for(let c of i)switch(c){case"once":l[c]=!0;break}o.push(l)}}}return o}function Ue(e){let t=[];for(let o of p.httpMethods){let[r]=x(o,e);r&&t.push({type:"request",method:o,url:$t(r,e)})}if(e instanceof CSSStyleRule){let o=k(e);o.has(E("harvest"))&&t.push({type:"harvest"}),o.has(E("dispatch"))&&t.push({type:"dispatch"})}return t}function $t(e,t){let o=t instanceof Element?t.baseURI:void 0;try{return new URL(e,o)}catch{return}}var Mt=new Set(["load","mutate"]);function _e(e){return Mt.has(e)?`${p.prefix}:${e}`:e}function Be(e){let t=`${p.prefix}:`;return e.startsWith(t)?e.substring(t.length):e}function*qt(e,t,o){let r=d(t,`control:${e}`);if(r&&(yield[t,t,r]),o)for(let[n,s]of b(`control:${e}`))n instanceof Element&&t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY&&(yield[n,n,s])}function*Vt(e,t,o){for(let[r,n]of b(`control:${e}`))if(n&&r instanceof CSSStyleRule&&X(r)&&(t.matches(r.selectorText)&&(yield[t,r,n]),o))for(let s of t.querySelectorAll(r.selectorText))yield[s,r,n]}function*Fe(e,t,o){yield*qt(e,t,o),yield*Vt(e,t,o)}var je=new Set;function Ge(e){if(!je.has(e)){let t={eventType:e};u(void 0,"addEventType",t)&&(je.add(e),addEventListener(_e(e),Ht),m(void 0,"addEventType",t))}}function Ht(e){for(let t of Kt(e))He(t)}function*Kt(e){if(e.target instanceof Element){let t=Fe(Be(e.type),e.target,Wt(e));for(let[o,r,n]of t){let s=$(o,r);yield{...n,event:e,source:o,sourceOwner:h(o),target:s,targetOwner:s!=="await"?h(s):void 0,control:r,controlOwner:h(r)}}}}function Wt(e){return e instanceof CustomEvent&&!!e.detail?.recursive}function Qe(e){let t=w(e.control);if(u(t,"processControl",e)){let{control:o,trigger:r,action:n,swap:s}=e,{eventType:i}=r;A(o,`control:${i}`,{trigger:r,action:n,swap:s}),Ge(i),m(t,"processControl",e)}}function Z(e){let t=We(e),o=Ue(e),r=be(e);for(let n of t)for(let s of o)Qe({control:e,trigger:n,action:s,swap:r})}function ee(e){let t=x("slot-name",e,"tokens");if(t.length){let o=d(e,"slotName",()=>new Set);t.forEach(r=>o.add(r))}}function U(e){if(we(e)){let t={owner:h(e)};u(e,"processElement",t)&&(t.owner&&N(e,t.owner),Z(e),ee(e),m(e,"processElement",t))}}function te(e){let t=new Set;[...p.ahxAttrs,...p.httpMethods].forEach(r=>{t.add(`[${L(r)}]`)});let o={selectors:t};if(u(e,"processElements",o)){let r=new Set;for(let n of o.selectors){!r.has(e)&&e instanceof Element&&e.matches(n)&&(r.add(e),U(e));for(let s of e.querySelectorAll(n))r.has(s)||(r.add(s),U(s))}m(e,"processElements",o)}}function Je(e){j(e,"mutate",{})}function M(e){j(e,"load",{recursive:!0})}function ze(e,t){let o=E("deny-trigger");if(t.has(o)){let[r]=g(o,e);r==="true"?A(e,"denyTrigger",!0):(e.style.removeProperty(o),R(e.parentStyleSheet?.ownerNode??document,"invalidCssValue",{prop:o,value:r,rule:e}))}return[]}var Ut=1;function Ye(e){let t=e.selectorText.includes("::before"),o=t?!1:e.selectorText.includes("::after");if(t||o){let r=d(e,"pseudoId")||Ut++,n=t?"before":"after",s=e.selectorText.replace(`::${n}`,"");for(let i of document.querySelectorAll(s))_t(i,r,n);return Bt(e,r,n)}}function _t(e,t,o){let r=`${p.prefix}-pseudo-${t}`;if(!e.querySelector(`:scope > .${r}`)){let n=e.localName,s=p.pseudoChildTags[n];if(s===null){R(e,"pseudoElementNotPermitted",{parentTag:n});return}s===void 0&&(s=p.pseudoChildTags["*"]??"span");let i=`${p.prefix}-pseudo-${o}`,l=document.createElement(s);l.setAttribute("class",`${p.prefix}-pseudo ${i} ${r}`);let c={pseudoElt:l,pseudoId:t,place:o};if(u(e,"pseudoElement",c)){let a=c.place==="before"?"afterbegin":"beforeend";e.insertAdjacentElement(a,c.pseudoElt),m(e,"pseudoElement",c)}}}function Bt(e,t,o){if(!D(e,"pseudoId")){A(e,"pseudoId",t);let r=`${p.prefix}-pseudo-${t}`,n=e.selectorText.replace(`::${o}`,` > .${r}`),s=e.cssText.replace(e.selectorText,n),i={selectorText:n,cssText:s,parentStyleSheet:e.parentStyleSheet},l={pseudoId:t,pseudoRule:i,rule:e,place:o,owner:h(e)},c=w(e)??document;if(u(c,"pseudoRule",l)){let a=l.pseudoRule.parentStyleSheet;if(a){let f=a.cssRules,S=f[a.insertRule(l.pseudoRule.cssText,f.length)];return!l.owner&&a.href&&(l.owner=a.href),l.owner&&N(S,l.owner),m(c,"pseudoRule",{...l,pseudoRule:S}),S}}}}function Xe(e,t){let o=!!w(e)?.ownerDocument?.querySelector(e.selectorText),r=g("import",e);for(let n of r){let s=d(e,"importLinks")?.get(n)?.deref();s?o&&s.sheet?.disabled?(s.sheet.disabled=!1,setTimeout(()=>{t?.(s)},0)):!o&&s.sheet&&(s.sheet.disabled=!0):o&&(s=Ft(n,w(e)?.crossOrigin??void 0,t),s&&d(e,"importLinks",()=>new Map).set(n,new WeakRef(s)))}}function Ft(e,t,o){let r={url:e,crossOrigin:t,disabled:!1};if(u(document,"cssImport",r)&&!document.querySelector(`link[rel="stylesheet"][href="${r.url}"]`)){let n=document.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("href",r.url),typeof r.crossOrigin=="string"&&n.setAttribute("crossorigin",r.crossOrigin),n.addEventListener("load",s=>{function i(l=1){setTimeout(()=>{n.sheet?(m(s.target??document,"cssImport",r),o?.(n)):l<1e3?i(l*2):console.error("ahx timeout loading stylesheet:",r.url,n.sheet)},l)}i()},{once:!0,passive:!0}),document.head.appendChild(n),n}}function ue(e,t){let o=Ke(e);if(e.parentStyleSheet&&jt(e.parentStyleSheet),t.size){let r=h(e),n={rule:e,props:t,owner:r},s=w(e)??document;if(u(s,"processRule",n)){n.owner&&N(e,n.owner),Qt(e,o,t),Xe(e,Gt),ze(e,t);let i=Ye(e);i&&ue(i,k(i)),Z(e),ee(e),m(s,"processRule",n)}}}function jt(e){D(e,"owner")||N(e,e.href??"unknown")}function Gt(e){q(e),M(e.ownerDocument.documentElement)}function Qt(e,t,o){let r=E("rule");o.has(r)||e.style.setProperty(r,t);let n=E(`rule-${t}`);o.has(n)||e.style.setProperty(n,t)}function q(e){let t={rules:Jt(e)};if(u(e,"processRules",t)){for(let[o,r]of t.rules)ue(o,r);m(e,"processRules",t)}}function Jt(e){let t=new Map;function o(s){if(!s.disabled)try{r(s.cssRules)}catch{}}function r(s){for(let i of s)i instanceof CSSImportRule&&i.styleSheet&&o(i.styleSheet),i instanceof CSSStyleRule&&n(i),i instanceof CSSGroupingRule&&i.cssRules.length&&r(i.cssRules)}function n(s){let i=k(s);i.size>0&&t.set(s,i)}if("sheet"in e&&e.sheet)o(e.sheet);else if("styleSheets"in e)for(let s of e.styleSheets)o(s);return t}function Ze(){for(let e of Ve()){let t=$(e.source,e.control);t instanceof Element&&(qe(e),Y({...e,target:t,targetOwner:h(t)}))}}function et(e){let t=new MutationObserver(r=>{let n={mutations:r};if(u(e,"mutations",n)){let s=new Set,i=new Set,l=new Set,c=new Set;for(let a of n.mutations){for(let f of a.removedNodes)s.add(f),f instanceof Element&&i.add(f);for(let f of a.addedNodes)s.delete(f),f instanceof Element&&(te(f),l.add(f));a.type==="attributes"&&a.target instanceof Element&&U(a.target),a.target instanceof Element&&c.add(a.target)}setTimeout(()=>{for(let a of c)Je(a)},0),setTimeout(()=>{for(let a of l)M(a)}),q(e),Ze(),m(e,"mutations",{...n,removedElements:i,addedElements:l,mutatedElements:c});for(let a of s)tt(a)}}),o={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0};u(e,"startObserver",o)&&(t.observe(e,o),m(e,"startObserver",o))}function tt(e){xe(e);for(let t of e.childNodes)tt(t)}function zt(e,t){e&&e.getAttribute(`${p.prefix}-url-href`)!==t.href&&(o("href",t.href),o("host",t.host),o("path",t.pathname),o("search",t.search),o("hash",t.hash));function o(r,n){let s=`${p.prefix}-url-${r}`;n?e.setAttribute(s,n):e.removeAttribute(s)}}function ot(e){function t(){zt(e.documentElement,e.location)}["DOMContentLoaded","load","hashchange","popstate"].forEach(o=>{addEventListener(o,t)}),t()}function rt(e){let t=L("debug-events"),o=e.querySelector(`[${t}]`);o&&(P.include=I(t,o),re())}function nt(e){rt(e),ot(e),et(e),q(e),te(e),M(e.documentElement)}ge(nt);window.ahx=fe;})();
//# sourceMappingURL=index.js.map
